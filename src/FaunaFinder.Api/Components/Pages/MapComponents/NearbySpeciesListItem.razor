@inject IAppLocalizer L

<MudListItem T="SpeciesNearbyDto" Class="nearby-species-item pa-2 mb-2 rounded border-default" OnClick="OnClick">
    <div class="d-flex justify-space-between align-start">
        <div class="d-flex align-start gap-2">
            @if (ShowColorDot && !string.IsNullOrEmpty(Color))
            {
                <span class="species-color-dot" style="background-color: @Color;"></span>
            }
            <div>
                <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Primary">@L.GetLocalizedValue(Species.CommonName)</MudText>
                <MudText Typo="Typo.caption" Color="MudBlazor.Color.Secondary">
                    <em>@Species.ScientificName</em>
                </MudText>
                @if (!string.IsNullOrEmpty(Species.LocationDescription))
                {
                    <MudText Typo="Typo.caption" Color="MudBlazor.Color.Secondary">
                        @Species.LocationDescription
                    </MudText>
                }
            </div>
        </div>
        <div class="d-flex flex-column align-end gap-1">
            <MudChip T="string" Size="Size.Small" Color="MudBlazor.Color.Info" Variant="Variant.Text">
                @FormatDistance(Species.DistanceMeters)
            </MudChip>
            <MudButton Variant="Variant.Text"
                       Size="Size.Small"
                       EndIcon="@Icons.Material.Filled.ChevronRight"
                       OnClick="OnDetailsClick"
                       Color="MudBlazor.Color.Primary">
                @L["Details"]
            </MudButton>
        </div>
    </div>
</MudListItem>

@code {
    [Parameter, EditorRequired] public SpeciesNearbyDto Species { get; set; } = null!;
    [Parameter] public bool ShowColorDot { get; set; }
    [Parameter] public string? Color { get; set; }
    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public EventCallback OnDetailsClick { get; set; }

    private static string FormatDistance(double meters)
    {
        if (meters < 1000)
        {
            return $"{meters:N0}m";
        }
        return $"{meters / 1000:N1}km";
    }
}
