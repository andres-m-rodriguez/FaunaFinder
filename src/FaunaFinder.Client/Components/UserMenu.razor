@using FaunaFinder.Client.Services.Auth
@inject IAppLocalizer L
@inject CookieAuthenticationStateProvider AuthStateProvider
@inject NavigationManager NavigationManager

<AuthorizeView>
    <Authorized>
        <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
            <ActivatorContent>
                <MudButton Variant="Variant.Text" Color="Color.Inherit" StartIcon="@Icons.Material.Filled.Person">
                    @context.User.Identity?.Name
                </MudButton>
            </ActivatorContent>
            <ChildContent>
                <MudMenuItem Icon="@Icons.Material.Filled.Person" Href="/profile">
                    @L["Login_Profile"]
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Logout" OnClick="HandleLogout">
                    @L["UserMenu_Logout"]
                </MudMenuItem>
            </ChildContent>
        </MudMenu>
    </Authorized>
    <NotAuthorized>
        <MudButton Variant="Variant.Text" Color="Color.Inherit" Href="/login" StartIcon="@Icons.Material.Filled.Login">
            @L["Login_SignIn"]
        </MudButton>
    </NotAuthorized>
</AuthorizeView>

@code {
    private async Task HandleLogout()
    {
        await AuthStateProvider.LogoutAsync();
        NavigationManager.NavigateTo("/");
    }
}
